

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20210927131547.jpg">
  <link rel="icon" href="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20210927131547.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="该博客使用Hexo+Github创建">
  <meta name="author" content="huanfenz">
  <meta name="keywords" content="">
  <meta name="description" content="Redis   发展 Web1.0时代 Web2.0时代 解决CPU及内存压力 解决IO压力 NoSQL数据库 NoSQL适用场景 NoSQL不适用场景 行式存储数据库 图关系型数据库   Redis概述 应用场景 Redis安装 前台启动（不推荐) 后台启动（推荐） 相关知识   常用五大数据类型 键（key） 字符串（String） 简介 常用命令 数据结构   列表（List） 简介 常用命">
<meta property="og:type" content="article">
<meta property="og:title" content="NoSQL数据库-Redis远程字典">
<meta property="og:url" content="https://huanfenz.top/2021/10/22/Redis/index.html">
<meta property="og:site_name" content="huanfenz的博客">
<meta property="og:description" content="Redis   发展 Web1.0时代 Web2.0时代 解决CPU及内存压力 解决IO压力 NoSQL数据库 NoSQL适用场景 NoSQL不适用场景 行式存储数据库 图关系型数据库   Redis概述 应用场景 Redis安装 前台启动（不推荐) 后台启动（推荐） 相关知识   常用五大数据类型 键（key） 字符串（String） 简介 常用命令 数据结构   列表（List） 简介 常用命">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008104849.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008104855.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008104909.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008105025.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008132736.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008132815.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008132817.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008133005.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008152720.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008153036.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008153225.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008153402.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008153443.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008153445.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132209133.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008160608.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211012215256.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013161435.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013162312.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013162339.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013162505.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013162707.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013162752.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013162952.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013163001.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013163029.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013163116.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013163142.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013163257.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013163327.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013163409.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013163649.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131637567.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131638203.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131638019.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131638938.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131639489.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131639386.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131641836.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131641199.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131650010.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131652647.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131652852.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131653814.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131658852.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131659844.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132003840.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132003262.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132005406.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132005590.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132006436.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132006430.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132006669.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132009317.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132052021.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132053245.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132053913.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132055205.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132055066.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132057980.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132057562.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132059478.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132059935.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132100067.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132101302.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132101662.png">
<meta property="og:image" content="c:/Users/wangpeng/AppData/Roaming/Typora/typora-user-images/image-20211013210125133.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132102640.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132102860.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132102673.png">
<meta property="og:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110141622053.png">
<meta property="article:published_time" content="2021-10-22T15:00:01.000Z">
<meta property="article:modified_time" content="2021-11-16T06:27:24.851Z">
<meta property="article:author" content="huanfenz">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="数据库">
<meta property="article:tag" content="NoSQL">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008104849.png">
  
  <title>NoSQL数据库-Redis远程字典 - huanfenz的博客</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/obsidian.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"huanfenz.top","root":"/","version":"1.8.12","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4","collapseDepth":2},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname"}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>huanfenz&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20210927141514.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="NoSQL数据库-Redis远程字典">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-10-22 23:00" pubdate>
        2021年10月22日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      23k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      73 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">NoSQL数据库-Redis远程字典</h1>
            
            <div class="markdown-body">
              <h1><span id="redis">Redis</span></h1><!-- toc -->

<ul>
<li><a href="#%E5%8F%91%E5%B1%95">发展</a><ul>
<li><a href="#web10%E6%97%B6%E4%BB%A3">Web1.0时代</a></li>
<li><a href="#web20%E6%97%B6%E4%BB%A3">Web2.0时代</a></li>
<li><a href="#%E8%A7%A3%E5%86%B3cpu%E5%8F%8A%E5%86%85%E5%AD%98%E5%8E%8B%E5%8A%9B">解决CPU及内存压力</a></li>
<li><a href="#%E8%A7%A3%E5%86%B3io%E5%8E%8B%E5%8A%9B">解决IO压力</a></li>
<li><a href="#nosql%E6%95%B0%E6%8D%AE%E5%BA%93">NoSQL数据库</a></li>
<li><a href="#nosql%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF">NoSQL适用场景</a></li>
<li><a href="#nosql%E4%B8%8D%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF">NoSQL不适用场景</a></li>
<li><a href="#%E8%A1%8C%E5%BC%8F%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE%E5%BA%93">行式存储数据库</a></li>
<li><a href="#%E5%9B%BE%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93">图关系型数据库</a></li>
</ul>
</li>
<li><a href="#redis%E6%A6%82%E8%BF%B0">Redis概述</a><ul>
<li><a href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF">应用场景</a></li>
<li><a href="#redis%E5%AE%89%E8%A3%85">Redis安装</a></li>
<li><a href="#%E5%89%8D%E5%8F%B0%E5%90%AF%E5%8A%A8%E4%B8%8D%E6%8E%A8%E8%8D%90">前台启动（不推荐)</a></li>
<li><a href="#%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E6%8E%A8%E8%8D%90">后台启动（推荐）</a></li>
<li><a href="#%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86">相关知识</a></li>
</ul>
</li>
<li><a href="#%E5%B8%B8%E7%94%A8%E4%BA%94%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">常用五大数据类型</a><ul>
<li><a href="#%E9%94%AEkey">键（key）</a></li>
<li><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2string">字符串（String）</a><ul>
<li><a href="#%E7%AE%80%E4%BB%8B">简介</a></li>
<li><a href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4">常用命令</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">数据结构</a></li>
</ul>
</li>
<li><a href="#%E5%88%97%E8%A1%A8list">列表（List）</a><ul>
<li><a href="#%E7%AE%80%E4%BB%8B-1">简介</a></li>
<li><a href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-1">常用命令</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-1">数据结构</a></li>
</ul>
</li>
<li><a href="#%E9%9B%86%E5%90%88set">集合（Set）</a><ul>
<li><a href="#%E7%AE%80%E4%BB%8B-2">简介</a></li>
<li><a href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-2">常用命令</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-2">数据结构</a></li>
</ul>
</li>
<li><a href="#%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88sorted-set">有序集合（sorted set）</a><ul>
<li><a href="#%E7%AE%80%E4%BB%8B-3">简介</a></li>
<li><a href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-3">常用命令</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-3">数据结构</a></li>
<li><a href="#%E8%B7%B3%E8%B7%83%E8%A1%A8%E8%B7%B3%E8%A1%A8">跳跃表（跳表）</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">Redis配置文件</a><ul>
<li><a href="#units-%E5%8D%95%E4%BD%8D">###Units 单位###</a></li>
<li><a href="#includes%E5%8C%85%E5%90%AB">###INCLUDES包含###</a></li>
<li><a href="#%E7%BD%91%E7%BB%9C%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE">###网络相关配置###</a><ul>
<li><a href="#bindfont-colorred%E9%87%8D%E8%A6%81font">bind（<font color="red">重要</font>）</a></li>
<li><a href="#protected-modefont-colorred%E9%87%8D%E8%A6%81font">protected-mode（<font color="red">重要</font>）</a></li>
<li><a href="#prot">prot</a></li>
<li><a href="#tcp-backlog">tcp-backlog</a></li>
<li><a href="#timeout">timeout</a></li>
<li><a href="#tcp-keepalive">tcp-keepalive</a></li>
</ul>
</li>
<li><a href="#general%E9%80%9A%E7%94%A8">###GENERAL通用###</a><ul>
<li><a href="#daemonize">daemonize</a></li>
<li><a href="#pidfile">pidfile</a></li>
<li><a href="#loglevel">loglevel</a></li>
<li><a href="#logfile">logfile</a></li>
<li><a href="#database16">database16</a></li>
</ul>
</li>
<li><a href="#security%E5%AE%89%E5%85%A8">###SECURITY安全###</a><ul>
<li><a href="#%E8%AE%BE%E7%BD%AE%E5%AF%86%E7%A0%81">设置密码</a></li>
</ul>
</li>
<li><a href="#limits">###LIMITS###</a><ul>
<li><a href="#maxclients">maxclients</a></li>
<li><a href="#maxmemory">maxmemory</a></li>
<li><a href="#maxmemory-policy">maxmemory-policy</a></li>
<li><a href="#maxmemory-samples">maxmemory-samples</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#redis%E5%8F%91%E5%B8%83%E5%92%8C%E8%AE%A2%E9%98%85">Redis发布和订阅</a><ul>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%8F%91%E5%B8%83%E5%92%8C%E8%AE%A2%E9%98%85">什么是发布和订阅</a></li>
<li><a href="#redis%E7%9A%84%E5%8F%91%E5%B8%83%E5%92%8C%E8%AE%A2%E9%98%85">Redis的发布和订阅</a></li>
<li><a href="#%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%AE%9E%E7%8E%B0">发布订阅命令行实现</a></li>
</ul>
</li>
<li><a href="#redis%E6%96%B0%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">Redis新数据类型</a><ul>
<li><a href="#bitmaps">Bitmaps</a><ul>
<li><a href="#%E7%AE%80%E4%BB%8B-4">简介</a></li>
<li><a href="#%E5%91%BD%E4%BB%A4">命令</a></li>
<li><a href="#bitmaps%E4%B8%8Eset%E5%AF%B9%E6%AF%94">Bitmaps与set对比</a></li>
</ul>
</li>
<li><a href="#hyperloglog">HyperLoglog</a><ul>
<li><a href="#%E7%AE%80%E4%BB%8B-5">简介</a></li>
<li><a href="#%E5%91%BD%E4%BB%A4-1">命令</a></li>
</ul>
</li>
<li><a href="#geospatial">Geospatial</a><ul>
<li><a href="#%E7%AE%80%E4%BB%8B-6">简介</a></li>
<li><a href="#%E5%91%BD%E4%BB%A4-2">命令</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#redis_jedis_%E6%B5%8B%E8%AF%95">Redis_Jedis_测试</a><ul>
<li><a href="#jedis%E6%89%80%E9%9C%80%E8%A6%81%E7%9A%84jar%E5%8C%85">Jedis所需要的jar包</a></li>
<li><a href="#%E8%BF%9E%E6%8E%A5redis%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">连接Redis的注意事项</a></li>
<li><a href="#%E6%B5%8B%E8%AF%95%E7%A8%8B%E5%BA%8F">测试程序</a></li>
<li><a href="#%E6%B5%8B%E8%AF%95%E7%9B%B8%E5%85%B3%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">测试相关数据类型</a><ul>
<li><a href="#key">Key</a></li>
<li><a href="#string">String</a></li>
<li><a href="#list">List</a></li>
<li><a href="#set">set</a></li>
<li><a href="#hash">hash</a></li>
<li><a href="#zset">zset</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#redis_jedis_%E5%AE%9E%E4%BE%8B">Redis_Jedis_实例</a><ul>
<li><a href="#%E5%AE%8C%E6%88%90%E4%B8%80%E4%B8%AA%E6%89%8B%E6%9C%BA%E9%AA%8C%E8%AF%81%E7%A0%81%E5%8A%9F%E8%83%BD">完成一个手机验证码功能</a></li>
</ul>
</li>
<li><a href="#redis%E4%B8%8Espringboot%E6%95%B4%E5%90%88">Redis与SpringBoot整合</a><ul>
<li><a href="#1-%E5%BC%95%E5%85%A5redis%E7%9B%B8%E5%85%B3%E4%BE%9D%E8%B5%96">1、引入redis相关依赖</a></li>
<li><a href="#2-applicationproperties-%E9%85%8D%E7%BD%AEredis%E9%85%8D%E7%BD%AE">2、application.properties 配置redis配置</a></li>
<li><a href="#3-%E6%B7%BB%E5%8A%A0redis%E9%85%8D%E7%BD%AE%E7%B1%BB">3、添加redis配置类</a></li>
<li><a href="#4-%E6%B5%8B%E8%AF%95">4、测试</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

<h2><span id="发展">发展</span></h2><p>技术的分类</p>
<p>1、解决功能性的问题：Java、Jsp、RDBMS、Tomcat、HTML、Linux、JDBC、SVN</p>
<p>2、解决扩展性的问题：Struts、Spring、SpringMVC、Hibernate、Mybatis</p>
<p>3、解决性能的问题：NoSQL、Java线程、Hadoop、Nginx、MQ、ElasticSearch</p>
<h3><span id="web10时代">Web1.0时代</span></h3><p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008104849.png" srcset="/img/loading.gif" lazyload alt="image-20211008104842391"></p>
<h3><span id="web20时代">Web2.0时代</span></h3><p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008104855.png" srcset="/img/loading.gif" lazyload alt="image-20211008104855821"></p>
<h3><span id="解决cpu及内存压力">解决CPU及内存压力</span></h3><p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008104909.png" srcset="/img/loading.gif" lazyload alt="image-20211008104909002"></p>
<h3><span id="解决io压力">解决IO压力</span></h3><p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008105025.png" srcset="/img/loading.gif" lazyload alt="image-20211008105025694"></p>
<h3><span id="nosql数据库">NoSQL数据库</span></h3><p>NoSQL(NoSQL = <strong>Not Only SQL</strong> )，意即“不仅仅是SQL”，泛指<strong>非关系型的数据库</strong>。 </p>
<p>NoSQL 不依赖业务逻辑方式存储，而以简单的<font color="red">key-value</font>模式存储。因此大大的增加了数据库的扩展能力。</p>
<ul>
<li><p>  不遵循SQL标准。</p>
</li>
<li><p>  不支持ACID (<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%8E%9F%E5%AD%90%E6%80%A7">原子性</a>（atomicity）、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E4%B8%80%E8%87%B4%E6%80%A7">一致性</a>（consistency）、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E9%9A%94%E7%A6%BB%E6%80%A7">独立性</a>（isolation）、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%8C%81%E4%B9%85%E6%80%A7">持久性</a>(durability) )。</p>
</li>
<li><p>  远超于SQL的性能。</p>
</li>
</ul>
<h3><span id="nosql适用场景">NoSQL适用场景</span></h3><ul>
<li><p>  对数据<font color="red">高并发</font>的读写</p>
</li>
<li><p>  <font color="red">海量数据</font> 的读写</p>
</li>
<li><p>  对数据<font color="red">高可扩展性</font>的</p>
</li>
</ul>
<h3><span id="nosql不适用场景">NoSQL不适用场景</span></h3><ul>
<li><p>  需要事务支持</p>
</li>
<li><p>  基于sql的结构化查询存储，处理复杂的关系,需要即席查询。</p>
</li>
<li><p>  （用不着sql的和用了sql也不行的情况，请考虑用NoSql）</p>
</li>
</ul>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008132736.png" srcset="/img/loading.gif" lazyload alt="image-20211008132736328"></p>
<h3><span id="行式存储数据库">行式存储数据库</span></h3><p>行式数据库</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008132815.png" srcset="/img/loading.gif" lazyload alt="image-20211008132815362"></p>
<p>列式数据库</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008132817.png" srcset="/img/loading.gif" lazyload alt="image-20211008132817953"></p>
<p>Hbase</p>
<p>HBase是<strong>Hadoop</strong>项目中的数据库。它用于需要对大量的数据进行随机、实时的读写操作的场景中。HBase的目标就是处理数据量<strong>非常庞大</strong>的表，可以用<strong>普通的计算机</strong>处理超过<strong>10****亿行数据</strong>，还可处理有数百万<strong>列</strong>元素的数据表。</p>
<p>Cassandra[kəˈsændrə]</p>
<p>Apache Cassandra是一款免费的开源NoSQL数据库，其设计目的在于管理由大量商用服务器构建起来的庞大集群上的<strong>海量数据集</strong>**(数据量通常达到PB级别)。在众多显著特性当中，Cassandra最为卓越的长处是对写入及读取操作进行规模调整，而且其不强调主集群的设计思路能够以相对直观的方式简化各集群的创建与扩展流程。</p>
<h3><span id="图关系型数据库">图关系型数据库</span></h3><p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008133005.png" srcset="/img/loading.gif" lazyload alt="image-20211008133005798"></p>
<h2><span id="redis概述">Redis概述</span></h2><ul>
<li><p>  Redis是一个开源的<font color="red">key-value</font>存储系统。</p>
</li>
<li><p>  和Memcached类似，它支持存储的value类型相对更多，包括<font color="red">string</font>(字符串)、<font color="red">list</font>(链表)、<font color="red">set</font>(集合)、<font color="red">zset</font>(sorted set –有序集合)和<font color="red">hash</font>（哈希类型）。</p>
</li>
<li><p>  这些数据类型都支持<font color="red">push/pop、add/remove</font>及取交集并集和差集及更丰富的操作，而且这些操作都是<font color="red">原子性</font>的。</p>
</li>
<li><p>  在此基础上，Redis支持各种不同方式的<font color="red">排序</font>。</p>
</li>
<li><p>  与memcached一样，为了保证效率，数据都是<font color="red">缓存在内存</font>中。</p>
</li>
<li><p>  区别的是Redis会<font color="red">周期性</font>的把更新的<font color="red">数据写入磁盘</font>或者把修改操作写入追加的记录文件。</p>
</li>
<li><p>  并且在此基础上实现了<font color="red">master-slave</font>(主从)同步。</p>
</li>
</ul>
<h3><span id="应用场景">应用场景</span></h3><ul>
<li>  配合关系型数据库做高速缓存</li>
<li>  多样的数据结构存储持久化数据</li>
</ul>
<h3><span id="redis安装">Redis安装</span></h3><p>中文官网：<a target="_blank" rel="noopener" href="http://redis.cn/">http://redis.cn/</a></p>
<ol>
<li>确保安装了C环境（在装linux的时候，如果勾选了开发环境，则自带）<ul>
<li>  <strong>gcc –version</strong>测试</li>
</ul>
</li>
<li>  下载redis-6.2.1.tar.gz放/opt目录</li>
<li>  解压命令：tar -zxvf redis-6.2.1.tar.gz</li>
<li>  解压完成后进入目录：cd redis-6.2.1</li>
<li>  在redis-6.2.1目录下再次执行make命令（只是编译好）</li>
<li>如果没有准备好C语言编译环境，make 会报错—Jemalloc/jemalloc.h：没有那个文件<ul>
<li>  解决方案：运行make distclean</li>
</ul>
</li>
<li>  跳过make test 继续执行: make install</li>
<li>安装目录：usr/local/bin<ul>
<li>  redis-benchmark:性能测试工具，可以在自己本子运行，看看自己本子性能如何</li>
<li>  redis-check-aof：修复有问题的AOF文件，rdb和aof后面讲</li>
<li>  redis-check-dump：修复有问题的dump.rdb文件</li>
<li>  redis-sentinel：Redis集群使用</li>
<li>  redis-server：Redis服务器启动命令</li>
<li>  <font color="red">redis-cli：客户端，操作入口</font></li>
</ul>
</li>
</ol>
<h3><span id="前台启动不推荐">前台启动（不推荐)</span></h3><p>前台启动，命令行窗口不能关闭，否则服务器停止</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008152720.png" srcset="/img/loading.gif" lazyload alt="image-20211008152720673"></p>
<h3><span id="后台启动推荐">后台启动（推荐）</span></h3><ol>
<li><p>备份redis.conf</p>
<ul>
<li><p>  拷贝一份redis.conf到其他目录</p>
</li>
<li><p>  cp /opt/redis-6.2.5/redis.conf /myredis/redis.conf</p>
</li>
</ul>
</li>
<li><p>后台启动设置拷贝后的文件daemonize no改成yes</p>
<ul>
<li>  修改redis.conf(128行)文件将里面的daemonize no 改成 yes，让服务在后台启动</li>
</ul>
</li>
<li><p>Redis启动</p>
<ol>
<li><p>redis-server /myredis/redis.conf</p>
<p>  <img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008153036.png" srcset="/img/loading.gif" lazyload alt="image-20211008153036602"></p>
</li>
</ol>
</li>
<li><p>redis-cli</p>
<p>  <img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008153225.png" srcset="/img/loading.gif" lazyload alt="image-20211008153225169"></p>
</li>
<li><p>  多个端口可以：redis-cli -p 6379</p>
</li>
<li><p>测试验证：ping</p>
<p>  <img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008153402.png" srcset="/img/loading.gif" lazyload alt="image-20211008153402789"></p>
</li>
<li><p>Redis关闭</p>
<p>  单实例关闭：redis-cli shutdown</p>
<p>  <img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008153443.png" srcset="/img/loading.gif" lazyload alt="image-20211008153443045"></p>
<p>  也可以进入终端后再关闭</p>
<p>   <img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008153445.png" srcset="/img/loading.gif" lazyload alt="image-20211008153445756"></p>
<p>  多实例关闭，指定端口关闭：redis-cli -p 6379 shutdown</p>
</li>
</ol>
<p>也可以直接kill掉进程</p>
<p><font color="red">改了端口号一定要带上端口号</font></p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132209133.png" srcset="/img/loading.gif" lazyload alt="image-20211013220924085"></p>
<h3><span id="相关知识">相关知识</span></h3><p>默认16个数据库，类似数组下标从0开始，<font color="red">初始默认使用0号库</font></p>
<p><font color="red"><code> select  &lt;dbid&gt;</code></font>来切换数据库。如: select 8 </p>
<p>统一密码管理，所有库同样密码。</p>
<p><font color="red">dbsize</font> 查看当前数据库的key的数量</p>
<p><font color="red">flushdb</font> 清空当前库</p>
<p><font color="red">flushall</font> 通杀全部库</p>
<p>Redis是单线程+多路IO复用技术</p>
<blockquote>
<p>  多路复用是指使用一个线程来检查多个文件描述符（Socket）的就绪状态，比如调用select和poll函数，传入多个文件描述符，如果有一个文件描述符就绪，则返回，否则阻塞直到超时。得到就绪状态后进行真正的操作可以在同一个线程里执行，也可以启动线程执行（比如使用线程池）</p>
<p>  串行  vs  多线程+锁（memcached） vs  单线程+多路IO复用(Redis)</p>
<p>  （与Memcache三点不同: 支持多数据类型，支持持久化，单线程+多路IO复用）      </p>
</blockquote>
<h2><span id="常用五大数据类型">常用五大数据类型</span></h2><h4><span id="键key">键（key）</span></h4><p>keys *                            查看当前库所有key  (匹配：keys *1)</p>
<p>exists key                    判断某个key是否存在</p>
<p>type key                        查看你的key是什么类型</p>
<p>del key                            删除指定的key数据</p>
<p><font color="red">unlink key                      根据value选择非阻塞删除</font></p>
<blockquote>
<p>  仅将keys从keyspace元数据中删除，真正的删除会在后续异步操作。</p>
</blockquote>
<p>expire key 10              10秒钟：为给定的key设置过期时间</p>
<p>ttl key                             查看还有多少秒过期，<font color="red">-1表示永不过期，-2表示已过期</font></p>
<p>select                            命令切换数据库</p>
<p>dbsize                        查看当前数据库的key的数量</p>
<p>flushdb                        清空当前库</p>
<p>flushall                            通杀全部库</p>
<h4><span id="字符串string">字符串（String）</span></h4><h5><span id="简介">简介</span></h5><p>String是Redis最基本的类型，你可以理解成与Memcached一模一样的类型，一个key对应一个value。</p>
<p>String类型<font color="red">是二进制安全的</font>。意味着Redis的string可以包含任何数据。比如jpg图片或者序列化的对象。</p>
<p>String类型是Redis最基本的数据类型，一个Redis中字符串value最多可以是<font color="red">512M</font>。</p>
<h5><span id="常用命令">常用命令</span></h5><p><code>set &lt;key&gt;&lt;value&gt;</code>                                    添加键值对</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211008160608.png" srcset="/img/loading.gif" lazyload alt="image-20211008160608094"></p>
<ul>
<li><p>  NX：当数据库中key不存在时，可以将key-value添加数据库</p>
</li>
<li><p>  XX：当数据库中key存在时，可以将key-value添加数据库，与NX参数互斥</p>
</li>
<li><p>  EX：key的超时秒数</p>
</li>
<li><p>PX：key的超时毫秒数，与EX互斥</p>
<p>  <code>get  &lt;key&gt;</code>                                        查询对应键值</p>
<p>  <code>append &lt;key&gt;&lt;value&gt;    </code>                        将给定的<code>&lt;value&gt;</code> 追加到原值的末尾</p>
</li>
</ul>
<p><code>strlen &lt;key&gt;</code>                                            获得值的长度</p>
<p><code>setnx &lt;key&gt;&lt;value&gt;</code>                                只有在 key 不存在时  设置 key 的值</p>
<p><code>incr &lt;key&gt;</code>                                                将 key 中储存的<font color="red">数字值</font>增1。只能对数字值操作，如果为空，新增值为1</p>
<p><code>decr &lt;key&gt;</code>                                                将 key 中储存的数字值减1。只能对数字值操作，如果为空，新增值为-1</p>
<p><code>incrby / decrby &lt;key&gt;&lt;步长&gt;</code>                将 key 中储存的数字值增减。自定义步长。</p>
<p><code>mset &lt;key1&gt;&lt;value1&gt;&lt;key2&gt;&lt;value2&gt;... </code>                同时设置一个或多个 key-value对 </p>
<p><code>mget &lt;key1&gt;&lt;key2&gt;&lt;key3&gt;...</code>                                    同时获取一个或多个 value </p>
<p><code>msetnx &lt;key1&gt;&lt;value1&gt;&lt;key2&gt;&lt;value2&gt;... </code>            同时设置一个或多个 key-value 对，当且仅当所有给定 key 都不存在。</p>
<p><code>getrange &lt;key&gt;&lt;起始位置&gt;&lt;结束位置&gt;</code>                        获得值的范围，类似java中的substring，<strong>前包，后包</strong></p>
<p><code>setrange &lt;key&gt;&lt;起始位置&gt;&lt;value&gt;</code>                            用<code>&lt;value&gt;</code>覆写<code>&lt;key&gt;</code>所储存的字符串值，从&lt;起始位置&gt;开始(<strong>索引从0****开始</strong>)。</p>
<p>**<code>setex &lt;key&gt;&lt;****过期时间****&gt;&lt;value&gt;**</code>            设置键值的同时，设置过期时间，单位秒。</p>
<p><code>getset &lt;key&gt;&lt;value&gt;</code>                                                    以新换旧，设置了新值同时获得旧值。</p>
<h5><span id="数据结构">数据结构</span></h5><p>String的数据结构为简单动态字符串(Simple Dynamic String,缩写SDS)。是可以修改的字符串，内部结构实现上类似于Java的ArrayList，采用预分配冗余空间的方式来减少内存的频繁分配.</p>
<p>​                               </p>
<p>如图中所示，内部为当前字符串实际分配的空间capacity一般要高于实际字符串长度len。当字符串长度小于1M时，扩容都是加倍现有的空间，如果超过1M，扩容时一次只会多扩1M的空间。需要注意的是字符串最大长度为512M。</p>
<h4><span id="列表list">列表（List）</span></h4><h5><span id="简介">简介</span></h5><p>单键多值</p>
<p>Redis 列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部（左边）或者尾部（右边）。</p>
<p>它的底层实际是个<font color="red">双向链表</font>，对两端的操作性能很高，通过索引下标的操作中间的节点性能会较差。</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211012215256.png" srcset="/img/loading.gif" lazyload alt="image-20211012215249452"></p>
<h5><span id="常用命令">常用命令</span></h5><p><code>lpush/rpush &lt;key&gt;&lt;value1&gt;&lt;value2&gt;&lt;value3&gt;...</code>                        从左边/右边插入一个或多个值。</p>
<p><code>lpop/rpop &lt;key&gt;</code>                                                                                    从左边/右边吐出一个值。值在键在，值光键亡。</p>
<p><code>rpoplpush &lt;key1&gt;&lt;key2&gt;</code>                                                                        从<code>&lt;key1&gt;</code>列表右边吐出一个值，插到<code>&lt;key2&gt;</code>列表左边。</p>
<p><code>lrange &lt;key&gt;&lt;start&gt;&lt;stop&gt;</code>                                                                按照索引下标获得元素(从左到右)</p>
<p><code>lrange mylist 0 -1</code>                                                                                 0左边第一个，-1右边第一个，（0-1表示获取所有）</p>
<p><code>lindex &lt;key&gt;&lt;index&gt;    </code>                                                                            按照索引下标获得元素(从左到右)</p>
<p><code>llen &lt;key&gt;</code>                                                                                                获得列表长度 </p>
<p><code>linsert &lt;key&gt; before &lt;value&gt;&lt;newvalue&gt;</code>                                        在<code>&lt;value&gt;</code>的后面插入<code>&lt;newvalue&gt;</code>插入值</p>
<p><code>lrem &lt;key&gt;&lt;n&gt;&lt;value&gt;</code>                                                                            从左边删除n个value(从左到右)</p>
<p><code>lset&lt;key&gt;&lt;index&gt;&lt;value&gt;</code>                                                                    将列表key下标为index的值替换成value</p>
<h5><span id="数据结构">数据结构</span></h5><p>List的数据结构为快速链表quickList。</p>
<p>首先在列表元素较少的情况下会使用一块连续的内存存储，这个结构是ziplist，也即是压缩列表。</p>
<p>它将所有的元素紧挨着一起存储，分配的是一块连续的内存。</p>
<p>当数据量比较多的时候才会改成quicklist。</p>
<p>因为普通的链表需要的附加指针空间太大，会比较浪费空间。比如这个列表里存的只是int类型的数据，结构上还需要两个额外的指针prev和next。</p>
<p>Redis将链表和ziplist结合起来组成了quicklist。也就是将多个ziplist使用双向指针串起来使用。这样既满足了快速的插入删除性能，又不会出现太大的空间冗余。</p>
<h4><span id="集合set">集合（Set）</span></h4><h5><span id="简介">简介</span></h5><p>Redis set对外提供的功能与list类似是一个列表的功能，特殊之处在于set是可以**<font color="red">自动排重</font>**的，当你需要存储一个列表数据，又不希望出现重复数据时，set是一个很好的选择，并且set提供了判断某个成员是否在一个set集合内的重要接口，这个也是list所不能提供的。</p>
<p>Redis的Set是string类型的无序集合。它底层其实是一个value为null的hash表，所以添加，删除，查找的**<font color="red">复杂度都是O(1)</font>**。</p>
<p>一个算法，随着数据的增加，执行时间的长短，如果是O(1)，数据增加，查找数据的时间不变</p>
<h5><span id="常用命令">常用命令</span></h5><p><code>sadd &lt;key&gt;&lt;value1&gt;&lt;value2&gt; ..... </code>                        将一个或多个 member 元素加入到集合 key 中，已经存在的 member 元素将被忽略</p>
<p><code>smembers &lt;key&gt;</code>                                                            取出该集合的所有值。</p>
<p><code>sismember &lt;key&gt;&lt;value&gt;</code>                                            判断集合<code>&lt;key&gt;</code>是否为含有该<code>&lt;value&gt;</code>值，有1，没有0</p>
<p><code>scard&lt;key&gt;</code>                                                                    返回该集合的元素个数。</p>
<p><code>srem &lt;key&gt;&lt;value1&gt;&lt;value2&gt; ....</code>                             删除集合中的某个元素。</p>
<p><code>spop &lt;key&gt;</code>                                                                        随机从该集合中吐出一个值。</p>
<p><code>srandmember &lt;key&gt;&lt;n&gt;</code>                                                    随机从该集合中取出n个值。不会从集合中删除 。</p>
<p><code>smove &lt;source&gt;&lt;destination&gt;value</code>                            把集合中一个值从一个集合移动到另一个集合</p>
<p><code>sinter &lt;key1&gt;&lt;key2&gt;</code>                                                        返回两个集合的交集元素。</p>
<p><code>sunion &lt;key1&gt;&lt;key2&gt;</code>                                                        返回两个集合的并集元素。</p>
<p><code>sdiff &lt;key1&gt;&lt;key2&gt;</code>                                                        返回两个集合的<strong>差集</strong>元素(key1中的，不包含key2中的)</p>
<h5><span id="数据结构">数据结构</span></h5><p>Set数据结构是dict字典，字典是用哈希表实现的。</p>
<p>Java中HashSet的内部实现使用的是HashMap，只不过所有的value都指向同一个对象。Redis的set结构也是一样，它的内部也使用hash结构，所有的value都指向同一个内部值。</p>
<h4><span id="有序集合sorted-set">有序集合（sorted set）</span></h4><h5><span id="简介">简介</span></h5><p>Redis有序集合zset与普通集合set非常相似，是一个<font color="red">没有重复元素</font>的字符串集合。</p>
<p>不同之处是有序集合的每个成员都关联了一个**<font color="red">评分（score）</font>**,这个评分（score）被用来按照从最低分到最高分的方式排序集合中的成员。<font color="red">集合的成员是唯一的，但是评分可以是重复了 </font>。</p>
<p>因为元素是有序的, 所以你也可以很快的根据评分（score）或者次序（position）来获取一个范围的元素。</p>
<p>访问有序集合的中间元素也是非常快的,因此你能够使用有序集合作为一个没有重复成员的智能列表。</p>
<h5><span id="常用命令">常用命令</span></h5><p><code>zadd &lt;key&gt;&lt;score1&gt;&lt;value1&gt;&lt;score2&gt;&lt;value2&gt;…</code></p>
<p>将一个或多个 member 元素及其 score 值加入到有序集 key 当中。</p>
<p><code>zrange &lt;key&gt;&lt;start&gt;&lt;stop&gt; [WITHSCORES]** </code></p>
<p>返回有序集 key 中，下标在<code>&lt;start&gt;&lt;stop&gt;</code>之间的元素</p>
<p>带WITHSCORES，可以让分数一起和值返回到结果集。</p>
<p><code>zrangebyscore key minmax [withscores] [limit offset count]</code></p>
<p>返回有序集 key 中，所有 score 值介于 min 和 max 之间(包括等于 min 或 max )的成员。有序集成员按 score 值递增(从小到大)次序排列。 </p>
<p><code>zrevrangebyscore key maxmin [withscores] [limit offset count]        </code></p>
<p>同上，改为从大到小排列。 </p>
<p><code>zincrby &lt;key&gt;&lt;increment&gt;&lt;value&gt;</code>               为元素的score加上增量</p>
<p><code>zrem &lt;key&gt;&lt;value&gt;</code>                                            删除该集合下，指定值的元素</p>
<p><code>zcount &lt;key&gt;&lt;min&gt;&lt;max&gt;</code>                                    统计该集合，分数区间内的元素个数 </p>
<p><code>zrank &lt;key&gt;&lt;value&gt;</code>                                            返回该值在集合中的排名，从0开始。</p>
<p>案例：如何利用zset实现一个文章访问量的排行榜？</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013161435.png" srcset="/img/loading.gif" lazyload alt="image-20211013161428255"></p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013162312.png" srcset="/img/loading.gif" lazyload alt="image-20211013162312595"></p>
<h5><span id="数据结构">数据结构</span></h5><p>SortedSet(zset)是Redis提供的一个非常特别的数据结构，一方面它等价于Java的数据结构Map&lt;String, Double&gt;，可以给每一个元素value赋予一个权重score，另一方面它又类似于TreeSet，内部的元素会按照权重score进行排序，可以得到每个元素的名次，还可以通过score的范围来获取元素的列表。</p>
<p>zset底层使用了两个数据结构</p>
<p>（1）hash，hash的作用就是关联元素value和权重score，保障元素value的唯一性，可以通过元素value找到相应的score值。</p>
<p>（2）跳跃表，跳跃表的目的在于给元素value排序，根据score的范围获取元素列表。</p>
<h5><span id="跳跃表跳表">跳跃表（跳表）</span></h5><p>1、简介</p>
<p>  有序集合在生活中比较常见，例如根据成绩对学生排名，根据得分对玩家排名等。对于有序集合的底层实现，可以用数组、平衡树、链表等。数组不便元素的插入、删除；平衡树或红黑树虽然效率高但结构复杂；链表查询需要遍历所有效率低。Redis采用的是跳跃表。跳跃表效率堪比红黑树，实现远比红黑树简单。</p>
<p>2、实例</p>
<p>  对比有序链表和跳跃表，从链表中查询出51</p>
<p>（1）  有序链表</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013162339.png" srcset="/img/loading.gif" lazyload alt="image-20211013162339456"></p>
<p>要查找值为51的元素，需要从第一个元素开始依次查找、比较才能找到。共需要6次比较。</p>
<p>（1）  跳跃表</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013162505.png" srcset="/img/loading.gif" lazyload alt="image-20211013162505023"></p>
<p>从第2层开始，1节点比51节点小，向后比较。</p>
<p>21节点比51节点小，继续向后比较，后面就是NULL了，所以从21节点向下到第1层</p>
<p>在第1层，41节点比51节点小，继续向后，61节点比51节点大，所以从41向下</p>
<p>在第0层，51节点为要查找的节点，节点被找到，共查找4次。</p>
<p>从此可以看出跳跃表比有序链表效率要高</p>
<h2><span id="redis配置文件">Redis配置文件</span></h2><p>自定义目录：/myredis/redis.conf</p>
<h3><span id="units-单位">###Units 单位###</span></h3><p>配置大小单位,开头定义了一些基本的度量单位，只支持bytes，不支持bit</p>
<p>大小写不敏感</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013162707.png" srcset="/img/loading.gif" lazyload alt="image-20211013162707881"></p>
<h3><span id="includes包含">###INCLUDES包含###</span></h3><p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013162752.png" srcset="/img/loading.gif" lazyload alt="image-20211013162752625"></p>
<p>类似jsp中的include，多实例的情况可以把公用的配置文件提取出来</p>
<h3><span id="网络相关配置">###网络相关配置###</span></h3><h4><span id="bind重要">bind（<font color="red">重要</font>）</span></h4><p>默认情况bind=127.0.0.1只能接受本机的访问请求</p>
<p>不写的情况下，无限制接受任何ip地址的访问</p>
<p>生产环境肯定要写你应用服务器的地址；服务器是需要远程访问的，所以需要将其注释掉</p>
<p><font color="red">如果开启了protected-mode，那么在没有设定bind ip且没有设密码的情况下，Redis只允许接受本机的响应</font>，==所以要注释掉==</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013162952.png" srcset="/img/loading.gif" lazyload alt="image-20211013162952076"></p>
<p>保存配置，停止服务，重启启动查看进程，不再是本机访问了。</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013163001.png" srcset="/img/loading.gif" lazyload alt="image-20211013163001398"></p>
<h4><span id="protected-mode重要">protected-mode（<font color="red">重要</font>）</span></h4><p>将本机访问保护模式设置no</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013163029.png" srcset="/img/loading.gif" lazyload alt="image-20211013163029472"></p>
<h4><span id="prot">prot</span></h4><p>端口号，默认 6379</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013163116.png" srcset="/img/loading.gif" lazyload alt="image-20211013163116480"></p>
<h4><span id="tcp-backlog">tcp-backlog</span></h4><p>设置tcp的backlog，backlog其实是一个连接队列，backlog队列总和=未完成三次握手队列 + 已经完成三次握手队列。</p>
<p>在高并发环境下你需要一个高backlog值来避免慢客户端连接问题。</p>
<p>注意Linux内核会将这个值减小到/proc/sys/net/core/somaxconn的值（128），所以需要确认增大/proc/sys/net/core/somaxconn和/proc/sys/net/ipv4/tcp_max_syn_backlog（128）两个值来达到想要的效果</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013163142.png" srcset="/img/loading.gif" lazyload alt="image-20211013163142400"></p>
<h4><span id="timeout">timeout</span></h4><p>一个空闲的客户端维持多少秒会关闭，0表示关闭该功能。即<font color="red">永不关闭</font>。</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013163257.png" srcset="/img/loading.gif" lazyload alt="image-20211013163257931"></p>
<h4><span id="tcp-keepalive">tcp-keepalive</span></h4><p>对访问客户端的一种<font color="red">心跳检测</font>，每个n秒检测一次。</p>
<p>单位为秒，如果设置为0，则不会进行Keepalive检测，建议设置成60。</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013163327.png" srcset="/img/loading.gif" lazyload alt="image-20211013163327484"></p>
<h3><span id="general通用">###GENERAL通用###</span></h3><h4><span id="daemonize">daemonize</span></h4><p>是否为后台进程，设置为yes</p>
<p>守护进程，后台启动</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013163409.png" srcset="/img/loading.gif" lazyload alt="image-20211013163409924"></p>
<h4><span id="pidfile">pidfile</span></h4><p>存放pid文件的位置，每个实例会产生一个不同的pid文件</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/20211013163649.png" srcset="/img/loading.gif" lazyload alt="image-20211013163649007"></p>
<h4><span id="loglevel">loglevel</span></h4><p>指定日志记录级别，Redis总共支持四个级别：debug、verbose、notice、warning，默认为<strong>notice</strong></p>
<p>四个级别根据使用阶段来选择，生产环境选择notice 或者warning</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131637567.png" srcset="/img/loading.gif" lazyload alt="image-20211013163741525"></p>
<h4><span id="logfile">logfile</span></h4><p>日志文件名称</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131638203.png" srcset="/img/loading.gif" lazyload alt="image-20211013163802169"></p>
<h4><span id="database16">database16</span></h4><p><font color="green">设定库的数量 默认16</font>，默认数据库为0，可以使用SELECT <dbid>命令在连接上指定数据库id</dbid></p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131638019.png" srcset="/img/loading.gif" lazyload alt="image-20211013163822988"></p>
<h3><span id="security安全">###SECURITY安全###</span></h3><h4><span id="设置密码">设置密码</span></h4><p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131638938.png" srcset="/img/loading.gif" lazyload alt="image-20211013163857892"></p>
<p>访问密码的查看、设置和取消</p>
<p>在命令中设置密码，只是临时的。重启redis服务器，密码就还原了。</p>
<p>永久设置，需要再配置文件中进行设置。</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131639489.png" srcset="/img/loading.gif" lazyload alt="image-20211013163918454"></p>
<h3><span id="limits">###LIMITS###</span></h3><h4><span id="maxclients">maxclients</span></h4><ul>
<li><p>  设置redis同时可以与多少个客户端进行连接。</p>
</li>
<li><p>  默认情况下为10000个客户端。</p>
</li>
<li><p>  如果达到了此限制，redis则会拒绝新的连接请求，并且向这些连接请求方发出“max number of clients reached”以作回应。</p>
</li>
</ul>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131639386.png" srcset="/img/loading.gif" lazyload alt="image-20211013163957343"></p>
<h4><span id="maxmemory">maxmemory</span></h4><ul>
<li><p>  建议<strong>必须设置</strong>，否则，将内存占满，造成服务器宕机</p>
</li>
<li><p>  设置redis可以使用的内存量。一旦到达内存使用上限，redis将会试图移除内部数据，移除规则可以通过maxmemory-policy来指定。</p>
</li>
<li><p>  如果redis无法根据移除规则来移除内存中的数据，或者设置了“不允许移除”，那么redis则会针对那些需要申请内存的指令返回错误信息，比如SET、LPUSH等。</p>
</li>
<li><p>  但是对于无内存申请的指令，仍然会正常响应，比如GET等。如果你的redis是主redis（说明你的redis有从redis），那么在设置内存使用上限时，需要在系统中留出一些内存空间给同步队列缓存，只有在你设置的是“不移除”的情况下，才不用考虑这个因素。</p>
</li>
</ul>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131641836.png" srcset="/img/loading.gif" lazyload alt="image-20211013164116771"></p>
<h4><span id="maxmemory-policy">maxmemory-policy</span></h4><ul>
<li><p>  volatile-lru：使用LRU算法移除key，只对设置了过期时间的键；（最近最少使用）</p>
</li>
<li><p>  allkeys-lru：在所有集合key中，使用LRU算法移除key</p>
</li>
<li><p>  volatile-random：在过期集合中移除随机的key，只对设置了过期时间的键</p>
</li>
<li><p>  allkeys-random：在所有集合key中，移除随机的key</p>
</li>
<li><p>  volatile-ttl：移除那些TTL值最小的key，即那些最近要过期的key</p>
</li>
<li><p>  noeviction：不进行移除。针对写操作，只是返回错误信息</p>
</li>
</ul>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131641199.png" srcset="/img/loading.gif" lazyload alt="image-20211013164156136"></p>
<h4><span id="maxmemory-samples">maxmemory-samples</span></h4><ul>
<li><p>  设置样本数量，LRU算法和最小TTL算法都并非是精确的算法，而是估算值，所以你可以设置样本的大小，redis默认会检查这么多个key并选择其中LRU的那个。</p>
</li>
<li><p>  一般设置3到7的数字，数值越小样本越不准确，但性能消耗越小。</p>
</li>
</ul>
<h2><span id="redis发布和订阅">Redis发布和订阅</span></h2><h3><span id="什么是发布和订阅">什么是发布和订阅</span></h3><p>Redis 发布订阅 (pub/sub) 是一种消息通信模式：<strong>发送者 (pub) 发送消息，订阅者 (sub) 接收消息</strong>。</p>
<p>Redis 客户端可以订阅任意数量的频道。</p>
<h3><span id="redis的发布和订阅">Redis的发布和订阅</span></h3><p>客户端可以订阅频道如下图</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131650010.png" srcset="/img/loading.gif" lazyload alt="image-20211013165011974"></p>
<p>当给这个频道发布消息后，消息就会发送给订阅的客户端</p>
<h3><span id="发布订阅命令行实现">发布订阅命令行实现</span></h3><p>1、 打开一个客户端订阅channel1</p>
<p>SUBSCRIBE channel1</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131652647.png" srcset="/img/loading.gif" lazyload alt="image-20211013165254607"></p>
<p>2、打开另一个客户端，给channel1发布消息hello</p>
<p>publish channel1 hello</p>
<p> <img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131652852.png" srcset="/img/loading.gif" lazyload alt="image-20211013165257825"></p>
<p>返回的1是订阅者数量</p>
<p>3、打开第一个客户端可以看到发送的消息</p>
<p> <img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131653814.png" srcset="/img/loading.gif" lazyload alt="image-20211013165300783"></p>
<p>注：发布的消息没有持久化，如果在订阅的客户端收不到hello，只能收到订阅后发布的消息</p>
<h2><span id="redis新数据类型">Redis新数据类型</span></h2><h3><span id="bitmaps">Bitmaps</span></h3><h4><span id="简介">简介</span></h4><p>现代计算机用二进制（位） 作为信息的基础单位， 1个字节等于8位， 例如“abc”字符串是由3个字节组成， 但实际在计算机存储时将其用二进制表示， “abc”分别对应的ASCII码分别是97、 98、 99， 对应的二进制分别是01100001、 01100010和01100011，如下图</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131658852.png" srcset="/img/loading.gif" lazyload alt="image-20211013165849816"></p>
<p>合理地使用操作位能够有效地提高内存使用率和开发效率。</p>
<p>   Redis提供了Bitmaps这个“数据类型”可以实现对位的操作：</p>
<p>（1）  Bitmaps本身不是一种数据类型， 实际上它就是字符串（key-value） ， 但是它可以对字符串的位进行操作。</p>
<p>（2）  Bitmaps单独提供了一套命令， 所以在Redis中使用Bitmaps和使用字符串的方法不太相同。 可以把Bitmaps想象成一个以位为单位的数组， 数组的每个单元只能存储0和1， 数组的下标在Bitmaps中叫做偏移量。</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110131659844.png" srcset="/img/loading.gif" lazyload alt="image-20211013165910810"></p>
<h4><span id="命令">命令</span></h4><p>1、setbit</p>
<p>（1）格式</p>
<p><code>setbit&lt;key&gt;&lt;offset&gt;&lt;value&gt;</code>设置Bitmaps中某个偏移量的值（0或1）</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132003840.png" srcset="/img/loading.gif" lazyload alt="image-20211013200300789"></p>
<p>*offset:偏移量从0开始</p>
<p>（2）实例</p>
<p>每个独立用户是否访问过网站存放在Bitmaps中， 将访问的用户记做1， 没有访问的用户记做0， 用偏移量作为用户的id。</p>
<p>设置键的第offset个位的值（从0算起） ， 假设现在有20个用户，userid=1， 6， 11， 15， 19的用户对网站进行了访问， 那么当前Bitmaps初始化结果如图</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132003262.png" srcset="/img/loading.gif" lazyload alt="image-20211013200322225"></p>
<p>unique:users:20201106代表2020-11-06这天的独立访问用户的Bitmaps</p>
<p><font color="red">注</font>：很多应用的用户id以一个指定数字（例如10000） 开头， 直接将用户id和Bitmaps的偏移量对应势必会造成一定的浪费， 通常的做法是每次做setbit操作时将用户id减去这个指定数字。</p>
<p>在第一次初始化Bitmaps时， 假如偏移量非常大， 那么整个初始化过程执行会比较慢， 可能会造成Redis的阻塞。</p>
<p>2、getbit</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132005406.png" srcset="/img/loading.gif" lazyload alt="image-20211013200519375"></p>
<p>获取键的第offset位的值（从0开始算）</p>
<p>获取id=8的用户是否在2020-11-06这天访问过， 返回0说明没有访问过：</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132005590.png" srcset="/img/loading.gif" lazyload alt="image-20211013200538560"></p>
<p>注：因为100根本不存在，所以也是返回0</p>
<p>3、bitcount</p>
<p>统计<strong>字符串</strong>被设置为1的bit数。一般情况下，给定的整个字符串都会被进行计数，通过指定额外的 start 或 end 参数，可以让计数只在特定的位上进行。start 和 end 参数的设置，都可以使用负数值：比如 -1 表示最后一个位，而 -2 表示倒数第二个位，start、end 是指bit组的字节的下标数，二者皆包含。</p>
<p>（1）格式</p>
<p><code>bitcount&lt;key&gt;[start end]</code> 统计字符串从start字节到end字节比特值为1的数量</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132006436.png" srcset="/img/loading.gif" lazyload alt="image-20211013200609405"></p>
<p>（2）实例</p>
<p>计算2022-11-06这天的独立访问用户数量</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132006430.png" srcset="/img/loading.gif" lazyload alt="image-20211013200626399"></p>
<p>start和end代表起始和结束字节数， 下面操作计算用户id在第1个字节到第3个字节之间的独立访问用户数， 对应的用户id是11， 15， 19。</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132006669.png" srcset="/img/loading.gif" lazyload alt="image-20211013200634639"></p>
<p><font color="red">举例： K1 【01000001 01000000 00000000 00100001】，对应【0，1，2，3】</font></p>
<p>bitcount K1 1 2 ： 统计下标1、2字节组中bit=1的个数，即01000000 00000000</p>
<p>–》bitcount K1 1 2 　　–》1</p>
<p>bitcount K1 1 3 ： 统计下标1、2字节组中bit=1的个数，即01000000 00000000 00100001</p>
<p>–》bitcount K1 1 3　　–》3</p>
<p>bitcount K1 0 -2 ： 统计下标0到下标倒数第2，字节组中bit=1的个数，即01000001 01000000  00000000</p>
<p>–》bitcount K1 0 -2　　–》3</p>
<p> 注意：redis的setbit设置或清除的是bit位置，而bitcount计算的是byte位置。</p>
<p>4、bitop</p>
<p>(1)格式</p>
<p><code>bitop and(or/not/xor) &lt;destkey&gt; [key…]</code></p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132009317.png" srcset="/img/loading.gif" lazyload alt="image-20211013200904276"></p>
<p>bitop是一个复合操作， 它可以做多个Bitmaps的and（交集） 、 or（并集） 、 not（非） 、 xor（异或） 操作并将结果保存在destkey中。</p>
<p>(2)实例</p>
<p>2020-11-04 日访问网站的userid=1,2,5,9。</p>
<p>setbit unique:users:20201104 1 1</p>
<p>setbit unique:users:20201104 2 1</p>
<p>setbit unique:users:20201104 5 1</p>
<p>setbit unique:users:20201104 9 1</p>
<p>2020-11-03 日访问网站的userid=0,1,4,9。</p>
<p>setbit unique:users:20201103 0 1</p>
<p>setbit unique:users:20201103 1 1</p>
<p>setbit unique:users:20201103 4 1</p>
<p>setbit unique:users:20201103 9 1</p>
<p>计算出两天都访问过网站的用户数量</p>
<p>bitop and unique:users:and:20201104_03</p>
<p> unique:users:20201103unique:users:20201104</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132052021.png" srcset="/img/loading.gif" lazyload alt="image-20211013205253987">         </p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132053245.png" srcset="/img/loading.gif" lazyload alt="image-20211013205302205">                 </p>
<p>计算出任意一天都访问过网站的用户数量（例如月活跃就是类似这种） ， 可以使用or求并集</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132053913.png" srcset="/img/loading.gif" lazyload alt="image-20211013205328881"></p>
<h4><span id="bitmaps与set对比">Bitmaps与set对比</span></h4><p>假设网站有1亿用户， 每天独立访问的用户有5千万， 如果每天用集合类型和Bitmaps分别存储活跃用户可以得到表</p>
<table>
<thead>
<tr>
<th>set和Bitmaps存储一天活跃用户对比</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>数据  类型</td>
<td>每个用户id占用空间</td>
<td>需要存储的用户量</td>
<td>全部内存量</td>
</tr>
<tr>
<td>集合  类型</td>
<td>64位</td>
<td>50000000</td>
<td>64位*50000000 = 400MB</td>
</tr>
<tr>
<td>Bitmaps</td>
<td>1位</td>
<td>100000000</td>
<td>1位*100000000 = 12.5MB</td>
</tr>
</tbody></table>
<p> 很明显， 这种情况下使用Bitmaps能节省很多的内存空间， 尤其是随着时间推移节省的内存还是非常可观的</p>
<table>
<thead>
<tr>
<th>set和Bitmaps存储独立用户空间对比</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>数据类型</td>
<td>一天</td>
<td>一个月</td>
<td>一年</td>
</tr>
<tr>
<td>集合类型</td>
<td>400MB</td>
<td>12GB</td>
<td>144GB</td>
</tr>
<tr>
<td>Bitmaps</td>
<td>12.5MB</td>
<td>375MB</td>
<td>4.5GB</td>
</tr>
</tbody></table>
<p>但Bitmaps并不是万金油， 假如该网站每天的独立访问用户很少， 例如只有10万（大量的僵尸用户） ， 那么两者的对比如下表所示， 很显然， 这时候使用Bitmaps就不太合适了， 因为基本上大部分位都是0。</p>
<table>
<thead>
<tr>
<th>set和Bitmaps存储一天活跃用户对比（独立用户比较少）</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>数据类型</td>
<td>每个userid占用空间</td>
<td>需要存储的用户量</td>
<td>全部内存量</td>
</tr>
<tr>
<td>集合类型</td>
<td>64位</td>
<td>100000</td>
<td>64位*100000 = 800KB</td>
</tr>
<tr>
<td>Bitmaps</td>
<td>1位</td>
<td>100000000</td>
<td>1位*100000000 = 12.5MB</td>
</tr>
</tbody></table>
<h3><span id="hyperloglog">HyperLoglog</span></h3><h4><span id="简介">简介</span></h4><p>在工作当中，我们经常会遇到与统计相关的功能需求，比如统计网站PV（PageView页面访问量）,可以使用Redis的incr、incrby轻松实现。</p>
<p>但像UV（UniqueVisitor，独立访客）、独立IP数、搜索记录数等需要去重和计数的问题如何解决？这种求集合中不重复元素个数的问题称为基数问题。</p>
<p>解决基数问题有很多种方案：</p>
<p>（1）数据存储在MySQL表中，使用distinct count计算不重复个数</p>
<p>（2）使用Redis提供的hash、set、bitmaps等数据结构来处理</p>
<p>以上的方案结果精确，但随着数据不断增加，导致占用空间越来越大，对于非常大的数据集是不切实际的。</p>
<p>能否能够降低一定的精度来平衡存储空间？Redis推出了HyperLogLog</p>
<p>Redis HyperLogLog 是用来做基数统计的算法，HyperLogLog 的优点是，在输入元素的数量或者体积非常非常大时，计算基数所需的空间总是固定的、并且是很小的。</p>
<p>在 Redis 里面，每个 HyperLogLog 键只需要花费 12 KB 内存，就可以计算接近 2^64 个不同元素的基数。这和计算基数时，元素越多耗费内存就越多的集合形成鲜明对比。</p>
<p>但是，因为 HyperLogLog 只会根据输入元素来计算基数，而不会储存输入元素本身，所以 HyperLogLog 不能像集合那样，返回输入的各个元素。</p>
<p>什么是基数?</p>
<p>比如数据集 {1, 3, 5, 7, 5, 7, 8}， 那么这个数据集的基数集为 {1, 3, 5 ,7, 8}, 基数(不重复元素)为5。 基数估计就是在误差可接受的范围内，快速计算基数。</p>
<h4><span id="命令">命令</span></h4><p>1、pfadd</p>
<p>（1）格式</p>
<p><code>pfadd &lt;key&gt;&lt; element&gt; [element ...]</code>  添加指定元素到 HyperLogLog 中</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132055205.png" srcset="/img/loading.gif" lazyload alt="image-20211013205531169"></p>
<p>（2）实例</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132055066.png" srcset="/img/loading.gif" lazyload></p>
<p>​    将所有元素添加到指定HyperLogLog数据结构中。如果执行命令后HLL估计的近似基数发生变化，则返回1，否则返回0。</p>
<p>2、pfcount</p>
<p>（1）格式</p>
<p><code>pfcount&lt;key&gt; [key ...]</code><font color="red">计算HLL的近似基数，可以计算多个HLL</font>，比如用HLL存储每天的UV，计算一周的UV可以使用7天的UV合并计算即可</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132057980.png" srcset="/img/loading.gif" lazyload alt="image-20211013205747946"></p>
<p>（2）实例</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132057562.png" srcset="/img/loading.gif" lazyload alt="image-20211013205758527"></p>
<p>3、pfmerge</p>
<p><code>pfmerge&lt;destkey&gt;&lt;sourcekey&gt; [sourcekey ...]</code> 将一个或多个HLL合并后的结果存储在另一个HLL中，比如每月活跃用户可以使用每天的活跃用户来合并计算可得</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132059478.png" srcset="/img/loading.gif" lazyload alt="image-20211013205908441"></p>
<p>（2）实例</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132059935.png" srcset="/img/loading.gif" lazyload alt="image-20211013205923901"></p>
<h3><span id="geospatial">Geospatial</span></h3><h4><span id="简介">简介</span></h4><p>Redis 3.2 中增加了对GEO类型的支持。GEO，Geographic，地理信息的缩写。该类型，就是元素的2维坐标，在地图上就是经纬度。redis基于该类型，提供了经纬度设置，查询，范围查询，距离查询，经纬度Hash等常见操作。</p>
<h4><span id="命令">命令</span></h4><p>1、geoadd</p>
<p>（1）格式</p>
<p><code>geoadd&lt;key&gt;&lt; longitude&gt;&lt;latitude&gt;&lt;member&gt; [longitude latitude member...]</code>  添加地理位置（经度，纬度，名称）</p>
<p>（2）实例</p>
<p>geoadd china:city 121.47 31.23 shanghai</p>
<p>geoadd china:city 106.50 29.53 chongqing 114.05 22.52 shenzhen 116.38 39.90 beijing</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132100067.png" srcset="/img/loading.gif" lazyload alt="image-20211013210027022"></p>
<p>两极无法直接添加，一般会下载城市数据，直接通过 Java 程序一次性导入。</p>
<p>有效的经度从 -180 度到 180 度。有效的纬度从 -85.05112878 度到 85.05112878 度。</p>
<p>当坐标位置超出指定范围时，该命令将会返回一个错误。</p>
<p>已经添加的数据，是无法再次往里面添加的。</p>
<p>2、geopos </p>
<p>（1）格式</p>
<p><code>geopos &lt;key&gt;&lt;member&gt; [member...]</code> 获得指定地区的坐标值</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132101302.png" srcset="/img/loading.gif" lazyload alt="image-20211013210100268"></p>
<p>（2）实例</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132101662.png" srcset="/img/loading.gif" lazyload alt="image-20211013210106628"></p>
<p>3、geodist</p>
<p><code>geodist&lt;key&gt;&lt;member1&gt;&lt;member2&gt; [m|km|ft|mi ]</code> 获取两个位置之间的直线距离</p>
<p><img src="C:\Users\wangpeng\AppData\Roaming\Typora\typora-user-images\image-20211013210125133.png" srcset="/img/loading.gif" lazyload alt="image-20211013210125133"></p>
<p>（2）实例</p>
<p>获取两个位置之间的直线距离</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132102640.png" srcset="/img/loading.gif" lazyload alt="image-20211013210207604"></p>
<p>单位：</p>
<p>m 表示单位为米[默认值]。</p>
<p>km 表示单位为千米。</p>
<p>mi 表示单位为英里。</p>
<p>ft 表示单位为英尺。</p>
<p>如果用户没有显式地指定单位参数， 那么 GEODIST 默认使用米作为单位</p>
<p>4、georadius</p>
<p>（1）格式</p>
<p><code>georadius&lt;key&gt;&lt; longitude&gt;&lt;latitude&gt;radius m|km|ft|mi</code>  以给定的经纬度为中心，找出某一半径内的元素</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132102860.png" srcset="/img/loading.gif" lazyload alt="image-20211013210231828"></p>
<p>经度 纬度 距离 单位</p>
<p>（2）实例</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110132102673.png" srcset="/img/loading.gif" lazyload alt="image-20211013210242640"></p>
<h2><span id="redis_jedis_测试">Redis_Jedis_测试</span></h2><h3><span id="jedis所需要的jar包">Jedis所需要的jar包</span></h3><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">&lt;dependency&gt;<br>    &lt;groupId&gt;redis.clients&lt;/groupId&gt;<br>    &lt;artifactId&gt;jedis&lt;/artifactId&gt;<br>    &lt;version&gt;<span class="hljs-number">3.2</span><span class="hljs-number">.0</span>&lt;/version&gt;<br>&lt;/dependency&gt;<br></code></pre></div></td></tr></table></figure>



<h3><span id="连接redis的注意事项">连接Redis的注意事项</span></h3><ol>
<li>  为了安全，最好给redis换个端口port，并设置密码 requirepass</li>
<li>  redis.conf中需要注释掉 bind 127.0.0.1</li>
<li>  redis.conf中需要设置保护模式为no，protected-mode no</li>
<li>  需要linux防火墙关闭或者放行端口（建议放行端口）</li>
<li>  如果用云服务器，注意在安全组放行对应端口。</li>
</ol>
<h3><span id="测试程序">测试程序</span></h3><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.wangpeng.test;<br><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo01</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Jedis jedis = <span class="hljs-keyword">new</span> Jedis(<span class="hljs-string">&quot;192.168.137.3&quot;</span>,<span class="hljs-number">6379</span>);<br>        String pong = jedis.ping();<br>        System.out.println(<span class="hljs-string">&quot;连接成功：&quot;</span>+pong);<br>        jedis.close();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>



<h3><span id="测试相关数据类型">测试相关数据类型</span></h3><h4><span id="key">Key</span></h4><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">jedis.set(<span class="hljs-string">&quot;k1&quot;</span>, <span class="hljs-string">&quot;v1&quot;</span>);<br>jedis.set(<span class="hljs-string">&quot;k2&quot;</span>, <span class="hljs-string">&quot;v2&quot;</span>);<br>jedis.set(<span class="hljs-string">&quot;k3&quot;</span>, <span class="hljs-string">&quot;v3&quot;</span>);<br>Set&lt;String&gt; keys = jedis.keys(<span class="hljs-string">&quot;*&quot;</span>);<br>System.out.println(keys.size());<br><span class="hljs-keyword">for</span> (String key : keys) &#123;<br>	System.out.println(key);<br>&#125;<br>System.out.println(jedis.exists(<span class="hljs-string">&quot;k1&quot;</span>));<br>System.out.println(jedis.ttl(<span class="hljs-string">&quot;k1&quot;</span>));                <br>System.out.println(jedis.get(<span class="hljs-string">&quot;k1&quot;</span>));<br><br></code></pre></div></td></tr></table></figure>



<h4><span id="string">String</span></h4><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">jedis.mset(<span class="hljs-string">&quot;str1&quot;</span>,<span class="hljs-string">&quot;v1&quot;</span>,<span class="hljs-string">&quot;str2&quot;</span>,<span class="hljs-string">&quot;v2&quot;</span>,<span class="hljs-string">&quot;str3&quot;</span>,<span class="hljs-string">&quot;v3&quot;</span>);<br>System.out.println(jedis.mget(<span class="hljs-string">&quot;str1&quot;</span>,<span class="hljs-string">&quot;str2&quot;</span>,<span class="hljs-string">&quot;str3&quot;</span>));<br></code></pre></div></td></tr></table></figure>



<h4><span id="list">List</span></h4><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">List&lt;String&gt; list = jedis.lrange(<span class="hljs-string">&quot;mylist&quot;</span>,<span class="hljs-number">0</span>,-<span class="hljs-number">1</span>);<br><span class="hljs-keyword">for</span> (String element : list) &#123;<br>	System.out.println(element);<br>&#125;<br></code></pre></div></td></tr></table></figure>



<h4><span id="set">set</span></h4><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">jedis.sadd(<span class="hljs-string">&quot;orders&quot;</span>, <span class="hljs-string">&quot;order01&quot;</span>);<br>jedis.sadd(<span class="hljs-string">&quot;orders&quot;</span>, <span class="hljs-string">&quot;order02&quot;</span>);<br>jedis.sadd(<span class="hljs-string">&quot;orders&quot;</span>, <span class="hljs-string">&quot;order03&quot;</span>);<br>jedis.sadd(<span class="hljs-string">&quot;orders&quot;</span>, <span class="hljs-string">&quot;order04&quot;</span>);<br>Set&lt;String&gt; smembers = jedis.smembers(<span class="hljs-string">&quot;orders&quot;</span>);<br><span class="hljs-keyword">for</span> (String order : smembers) &#123;<br>	System.out.println(order);<br>&#125;<br>jedis.srem(<span class="hljs-string">&quot;orders&quot;</span>, <span class="hljs-string">&quot;order02&quot;</span>);<br></code></pre></div></td></tr></table></figure>



<h4><span id="hash">hash</span></h4><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">jedis.hset(<span class="hljs-string">&quot;hash1&quot;</span>,<span class="hljs-string">&quot;userName&quot;</span>,<span class="hljs-string">&quot;lisi&quot;</span>);<br>System.out.println(jedis.hget(<span class="hljs-string">&quot;hash1&quot;</span>,<span class="hljs-string">&quot;userName&quot;</span>));<br>Map&lt;String,String&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;String,String&gt;();<br>map.put(<span class="hljs-string">&quot;telphone&quot;</span>,<span class="hljs-string">&quot;13810169999&quot;</span>);<br>map.put(<span class="hljs-string">&quot;address&quot;</span>,<span class="hljs-string">&quot;atguigu&quot;</span>);<br>map.put(<span class="hljs-string">&quot;email&quot;</span>,<span class="hljs-string">&quot;abc@163.com&quot;</span>);<br>jedis.hmset(<span class="hljs-string">&quot;hash2&quot;</span>,map);<br>List&lt;String&gt; result = jedis.hmget(<span class="hljs-string">&quot;hash2&quot;</span>, <span class="hljs-string">&quot;telphone&quot;</span>,<span class="hljs-string">&quot;email&quot;</span>);<br><span class="hljs-keyword">for</span> (String element : result) &#123;<br>	System.out.println(element);<br>&#125;<br><br></code></pre></div></td></tr></table></figure>



<h4><span id="zset">zset</span></h4><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">jedis.zadd(<span class="hljs-string">&quot;zset01&quot;</span>, <span class="hljs-number">100d</span>, <span class="hljs-string">&quot;z3&quot;</span>);<br>jedis.zadd(<span class="hljs-string">&quot;zset01&quot;</span>, <span class="hljs-number">90d</span>, <span class="hljs-string">&quot;l4&quot;</span>);<br>jedis.zadd(<span class="hljs-string">&quot;zset01&quot;</span>, <span class="hljs-number">80d</span>, <span class="hljs-string">&quot;w5&quot;</span>);<br>jedis.zadd(<span class="hljs-string">&quot;zset01&quot;</span>, <span class="hljs-number">70d</span>, <span class="hljs-string">&quot;z6&quot;</span>);<br> <br>Set&lt;String&gt; zrange = jedis.zrange(<span class="hljs-string">&quot;zset01&quot;</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>);<br><span class="hljs-keyword">for</span> (String e : zrange) &#123;<br>	System.out.println(e);<br>&#125;<br></code></pre></div></td></tr></table></figure>



<h2><span id="redis_jedis_实例">Redis_Jedis_实例</span></h2><h3><span id="完成一个手机验证码功能">完成一个手机验证码功能</span></h3><p>要求：</p>
<p>1、输入手机号，点击发送后随机生成6位数字码，2分钟有效</p>
<p>2、输入验证码，点击验证，返回成功或失败</p>
<p>3、每个手机号每天只能输入3次</p>
<p><img src="http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202110141622053.png" srcset="/img/loading.gif" lazyload alt="image-20211014162205959"></p>
<p>这里就不写界面了，演示个Demo</p>
<p>代码</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.wangpeng.demo1;<br><br><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;<br><br><span class="hljs-keyword">import</span> java.util.Random;<br><span class="hljs-keyword">import</span> java.util.Scanner;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 思路：</span><br><span class="hljs-comment"> * 1. 输入手机号</span><br><span class="hljs-comment"> * 2. 判断该手机号的发送次数，满了返回失败，没满count++并放置验证码到redis中</span><br><span class="hljs-comment"> * 3. 发短信，把验证码发给目标手机</span><br><span class="hljs-comment"> * 4. 用户输入验证码，与redis中的验证码进行比较，输出成功与否</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VerifyCode</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-comment">//输入手机号</span><br>        System.out.print(<span class="hljs-string">&quot;请输入手机号:&quot;</span>);<br>        Scanner sc = <span class="hljs-keyword">new</span> Scanner(System.in);<br>        String phone = sc.next();<br><br>        <span class="hljs-comment">//放置验证码</span><br>        String code = setCode(phone);<br>        <span class="hljs-keyword">if</span>(code == <span class="hljs-keyword">null</span>) &#123;  <span class="hljs-comment">//没成功放置，说明满了3次</span><br>            System.out.println(<span class="hljs-string">&quot;今日已发送3次，请明天再尝试&quot;</span>);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-comment">//发送短信</span><br>        System.out.println(<span class="hljs-string">&quot;发送短信,您的验证码是:&quot;</span> + code);<br><br>        <span class="hljs-comment">//等待用户输入验证码</span><br>        System.out.print(<span class="hljs-string">&quot;请输入验证码:&quot;</span>);<br>        String userCode = sc.next();<br><br>        <span class="hljs-comment">//得到验证码进行校验</span><br>        String redisCode = getCode(phone);<br>        <span class="hljs-keyword">if</span>(redisCode == <span class="hljs-keyword">null</span>) &#123; <span class="hljs-comment">//没成功得到，说明验证码超时</span><br>            System.out.println(<span class="hljs-string">&quot;验证码超时，请重新获取&quot;</span>);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(userCode.equals(redisCode)) &#123;<br>            System.out.println(<span class="hljs-string">&quot;恭喜你，验证码正确&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;很抱歉，验证码错误&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">getCode</span><span class="hljs-params">(String phone)</span> </span>&#123;<br>        <span class="hljs-comment">//连接redis</span><br>        Jedis jedis = <span class="hljs-keyword">new</span> Jedis(<span class="hljs-string">&quot;47.97.104.230&quot;</span>, <span class="hljs-number">6379</span>);<br>        jedis.auth(<span class="hljs-string">&quot;自己的密码&quot;</span>);<br><br>        String codeKey = <span class="hljs-string">&quot;VerifyCode&quot;</span> + phone + <span class="hljs-string">&quot;:code&quot;</span>;<br><br>        <span class="hljs-comment">// 获得验证码</span><br>        String code = jedis.get(codeKey);<br><br>        jedis.close();<br>        <span class="hljs-keyword">return</span> code;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 得到验证码</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> phone</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">setCode</span><span class="hljs-params">(String phone)</span> </span>&#123;<br>        <span class="hljs-comment">//连接redis</span><br>        Jedis jedis = <span class="hljs-keyword">new</span> Jedis(<span class="hljs-string">&quot;47.97.104.230&quot;</span>, <span class="hljs-number">6379</span>);<br>        jedis.auth(<span class="hljs-string">&quot;自己的密码&quot;</span>);<br><br>        String countKey = <span class="hljs-string">&quot;VerifyCode&quot;</span> + phone + <span class="hljs-string">&quot;:count&quot;</span>;<br>        String codeKey = <span class="hljs-string">&quot;VerifyCode&quot;</span> + phone + <span class="hljs-string">&quot;:code&quot;</span>;<br><br>        <span class="hljs-comment">//得到次数</span><br>        String countStr = jedis.get(countKey);<br>        <span class="hljs-keyword">if</span>(countStr == <span class="hljs-keyword">null</span>) &#123; <span class="hljs-comment">//当前是0次</span><br>            jedis.setex(countKey, <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span>,<span class="hljs-string">&quot;1&quot;</span>); <span class="hljs-comment">//设置1次，时间24小时</span><br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(Integer.parseInt(countStr) &lt;= <span class="hljs-number">2</span>) &#123; <span class="hljs-comment">//当前小于2次</span><br>            jedis.incr(countKey);<br>        &#125; <span class="hljs-keyword">else</span> &#123;    <span class="hljs-comment">//否则大于2次，不能发了</span><br>            jedis.close();  <span class="hljs-comment">//返回前关闭redis</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>        &#125;<br><br>        String verifyCode = createCode();<br>        <span class="hljs-comment">//放进redis</span><br>        jedis.setex(codeKey, <span class="hljs-number">60</span> * <span class="hljs-number">2</span>, verifyCode); <span class="hljs-comment">//自动覆盖</span><br><br>        jedis.close();  <span class="hljs-comment">//返回前关闭redis</span><br>        <span class="hljs-keyword">return</span> verifyCode;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 创建一个验证码</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 验证码</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">createCode</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-comment">//取5位随机数,10000~99999</span><br>        Random random = <span class="hljs-keyword">new</span> Random();<br>        Integer randomNumb = random.nextInt(<span class="hljs-number">89999</span>) + <span class="hljs-number">10000</span>;<br>        <span class="hljs-keyword">return</span> randomNumb.toString();<br>    &#125;<br>&#125;<br><br></code></pre></div></td></tr></table></figure>



<h2><span id="redis与springboot整合">Redis与SpringBoot整合</span></h2><h3><span id="1-引入redis相关依赖">1、引入redis相关依赖</span></h3><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- redis --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- spring2.X集成redis所需common-pool2--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-pool2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.6.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></div></td></tr></table></figure>



<h3><span id="2-applicationproperties-配置redis配置">2、application.properties 配置redis配置</span></h3><figure class="highlight properties"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment">#Redis服务器地址</span><br><span class="hljs-meta">spring.redis.host</span>=<span class="hljs-string">192.168.140.136</span><br><span class="hljs-comment">#Redis服务器连接端口</span><br><span class="hljs-meta">spring.redis.port</span>=<span class="hljs-string">6379</span><br><span class="hljs-comment">#Redis数据库索引（默认为0）</span><br><span class="hljs-meta">spring.redis.database</span>= <span class="hljs-string">0</span><br><span class="hljs-comment">#连接超时时间（毫秒）</span><br><span class="hljs-meta">spring.redis.timeout</span>=<span class="hljs-string">1800000</span><br><span class="hljs-comment">#连接池最大连接数（使用负值表示没有限制）</span><br><span class="hljs-meta">spring.redis.lettuce.pool.max-active</span>=<span class="hljs-string">20</span><br><span class="hljs-comment">#最大阻塞等待时间(负数表示没限制)</span><br><span class="hljs-meta">spring.redis.lettuce.pool.max-wait</span>=<span class="hljs-string">-1</span><br><span class="hljs-comment">#连接池中的最大空闲连接</span><br><span class="hljs-meta">spring.redis.lettuce.pool.max-idle</span>=<span class="hljs-string">5</span><br><span class="hljs-comment">#连接池中的最小空闲连接</span><br><span class="hljs-meta">spring.redis.lettuce.pool.min-idle</span>=<span class="hljs-string">0</span><br></code></pre></div></td></tr></table></figure>



<h3><span id="3-添加redis配置类">3、添加redis配置类</span></h3><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@EnableCaching</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CachingConfigurerSupport</span> </span>&#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="hljs-title">redisTemplate</span><span class="hljs-params">(RedisConnectionFactory factory)</span> </span>&#123;<br>        RedisTemplate&lt;String, Object&gt; template = <span class="hljs-keyword">new</span> RedisTemplate&lt;&gt;();<br>        RedisSerializer&lt;String&gt; redisSerializer = <span class="hljs-keyword">new</span> StringRedisSerializer();<br>        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = <span class="hljs-keyword">new</span> Jackson2JsonRedisSerializer(Object.class);<br>        ObjectMapper om = <span class="hljs-keyword">new</span> ObjectMapper();<br>        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);<br>        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);<br>        jackson2JsonRedisSerializer.setObjectMapper(om);<br>        template.setConnectionFactory(factory);<br><span class="hljs-comment">//key序列化方式</span><br>        template.setKeySerializer(redisSerializer);<br><span class="hljs-comment">//value序列化</span><br>        template.setValueSerializer(jackson2JsonRedisSerializer);<br><span class="hljs-comment">//value hashmap序列化</span><br>        template.setHashValueSerializer(jackson2JsonRedisSerializer);<br>        <span class="hljs-keyword">return</span> template;<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> CacheManager <span class="hljs-title">cacheManager</span><span class="hljs-params">(RedisConnectionFactory factory)</span> </span>&#123;<br>        RedisSerializer&lt;String&gt; redisSerializer = <span class="hljs-keyword">new</span> StringRedisSerializer();<br>        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = <span class="hljs-keyword">new</span> Jackson2JsonRedisSerializer(Object.class);<br><span class="hljs-comment">//解决查询缓存转换异常的问题</span><br>        ObjectMapper om = <span class="hljs-keyword">new</span> ObjectMapper();<br>        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);<br>        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);<br>        jackson2JsonRedisSerializer.setObjectMapper(om);<br><span class="hljs-comment">// 配置序列化（解决乱码的问题）,过期时间600秒</span><br>        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()<br>                .entryTtl(Duration.ofSeconds(<span class="hljs-number">600</span>))<br>                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(redisSerializer))<br>                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(jackson2JsonRedisSerializer))<br>                .disableCachingNullValues();<br>        RedisCacheManager cacheManager = RedisCacheManager.builder(factory)<br>                .cacheDefaults(config)<br>                .build();<br>        <span class="hljs-keyword">return</span> cacheManager;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>



<h3><span id="4-测试">4、测试</span></h3><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/redisTest&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisTestController</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisTemplate redisTemplate;<br><br>    <span class="hljs-meta">@GetMapping</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">testRedis</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-comment">//设置值到redis</span><br>        redisTemplate.opsForValue().set(<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;lucy&quot;</span>);<br>        <span class="hljs-comment">//从redis获取值</span><br>        String name = (String)redisTemplate.opsForValue().get(<span class="hljs-string">&quot;name&quot;</span>);<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>


            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/Java%E5%90%8E%E7%AB%AF/">Java后端</a>
                    
                      <a class="hover-with-bg" href="/categories/Java%E5%90%8E%E7%AB%AF/NoSQL%E6%95%B0%E6%8D%AE%E5%BA%93/">NoSQL数据库</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Java/">Java</a>
                    
                      <a class="hover-with-bg" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
                    
                      <a class="hover-with-bg" href="/tags/NoSQL/">NoSQL</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/10/25/SpringBoot/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">SpringBoot框架</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/10/07/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7-Git/">
                        <span class="hidden-mobile">开发工具-Git和GitHub</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"kKHw5YzfOlny9jMQJEjDkSBi-9Nh9j0Va","appKey":"3N5RE5Sl5hj96cTuho5YEMnY","path":"window.location.pathname","placeholder":"小伙伴们快来评论！","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":true,"recordIP":true,"serverURLs":"https://kkhw5yzf.lc-cn-e1-shared.com","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          Fluid.plugins.initFancyBox('#valine .vcontent img:not(.vemoji)');
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
    <span>Copyright© 2021 huanfenz</span>
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>





  

  
    <!-- MathJax -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        loader: {
          load: ['ui/lazy']
        },
        options: {
          renderActions: {
            findScript: [10, doc => {
              document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                const display = !!node.type.match(/; *mode=display/);
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                const text = document.createTextNode('');
                node.parentNode.replaceChild(text, node);
                math.start = { node: text, delim: '', n: 0 };
                math.end = { node: text, delim: '', n: 0 };
                doc.math.push(math);
              });
            }, '', false],
            insertedScript: [200, () => {
              document.querySelectorAll('mjx-container').forEach(node => {
                let target = node.parentNode;
                if (target.nodeName.toLowerCase() === 'li') {
                  target.parentNode.classList.add('has-jax');
                }
              });
            }, '', false]
          }
        }
      };
    </script>

    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" ></script>

  











<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
